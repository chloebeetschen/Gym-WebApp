<!-- Template for calender frontend -->
{% extends "base.html" %}
{% block content %}
<div class="calendar">

<!-- Flashed error Messages -->
<div class="d-flex align-items-center flashed-msg-container justify-content-center">
    {% with messages = get_flashed_messages(with_categories=True) %}
        {% if messages %}
        {% for category, message in messages %}
            <div class="{{ category }} alert-box rounded-4 p-5">
            <span class="closebtn" onclick="this.parentElement.style.display='none';">&times</span>
            {{ message }}
            </div>
        {% endfor %}
        {% endif %}
    {% endwith %}
</div>


<!--Basic Header-->
<h1>Calendar</h1>
<h2>If you would like to book one of our sessions that is open all day please choose from below.</h2>
<a href="/repeatEvents/2"><button type="button" class="btn btn-primary">Lane Swimming</button></a>
<a href="/repeatEvents/4"><button type="button" class="btn btn-primary">General Use Swimming</button></a>
<a href="/repeatEvents/3"><button type="button" class="btn btn-primary">Swimming Lessons</button></a>
<a href="/repeatEvents/5"><button type="button" class="btn btn-primary">Gym</button></a>
<a href="/repeatEvents/7"><button type="button" class="btn btn-primary">Climbing</button></a>
<a href="/repeatEvents/6"><button type="button" class="btn btn-primary">Squash</button></a>
<a href="/repeatEvents/12"><button type="button" class="btn btn-primary">Sports Hall Session</button></a>


<!--Basic table to hold calendar information-->
<table class="table">
    <thead>
        <tr>
            <th>Week 1</th>
            <th>Week 2</th>
        </tr>
    </thead>
    <tbody>
        <!--W1-->
        <td>
            {% for j in range(0, 7) %}
                <table class="table">
                    <h3>{{weeks[j].strftime("%A")}} - {{weeks[j].strftime("%d/%m/%y")}}</h3>
                    <thead>
                        <th>Time</th>
                        <th>Activity Name</th>
                        <th>Spaces Left</th>
                        {% if member == False %}
                            <th>Price</th>                        
                        {% endif %}
                        <th></th>
                        <th></th>
                    </thead>
                    <tbody>
                        {% for i in range(numEvents) %}
                            {% if events[i].aDateTime.weekday() == weeks[j].weekday() %} 
                                <tr>
                                    <!--display event and event info in the tables-->
                                    <td>{{events[i].aDateTime.strftime("%H:%M")}}</td>
                                    <td>{{eventInfo[i].activityType}}</td>
                                    <td>{{events[i].aCapacity-events[i].aSlotsTaken}}</td>
                                    {% if member == False %}
                                        <td>{{events[i].aPrice}}</td>
                                    {% endif %}
                                    <!--TODO Popup for event info-->
                                    {% if current_user.userType == 3 %}
                                        <td><a href="/editEvent/{{events[i].id}}"><button type="button" class="btn btn-primary">Edit/View Event</button></td>
                                    {% else %}
                                    <td><button type="button" class="btn btn-primary event-info">Event Info 
                                        <!-- Popup for event info -->
                                        <span class="event-info-popup">
                                            <div class="table-responsive">
                                                <table class="table popup-table">
                                                    <tr>
                                                        <td> Duration </td>
                                                        <td class="fw-light"> {{ events[i].aDuration }}  </td>
                                                    </tr>
                                                    <tr>
                                                        <td> Location </td>
                                                        <td> {{ events[i].aLocation }}  </td>
                                                    </tr>   
                                                    <tr>
                                                        <td> Staff </td>
                                                        <td> {{ events[i].aStaffName }}  </td>
                                                    </tr>             
                                                    <tr>
                                                        <td> Price </td>
                                                        <td> £{{ events[i].aPrice }}  </td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </span> 
                                    </button></td>
                                    {% endif %}
                                    <!--If statement to see if acitivity is full and whether or not to dispay bookable button-->
                                    {% if current_user.userType != 3 %}
                                        <td>
                                            {% if userBooked1[i]==True %}
                                                <a href=""></a><button type="button" class="btn btn-primary" id="disabled">Booked</button></a>
                                            {% elif events[i].aSlotsTaken == events[i].aCapacity %}
                                                <a href=""></a><button type="button" class="btn btn-primary" id="disabled">Full</button></a>
                                            {% else %}
                                                {% if isMember == False %}
                                                    <a href="/addBasket/{{events[i].id}}"><button type="button" class="btn btn-primary">Add to Basket</button>
                                                {% else %}    
                                                    <a href="/makeBooking/{{events[i].id}}"><button type="button" class="btn btn-primary">Book</button>
                                                {% endif %}
                                            {% endif %}
                                        </td>
                                    {% endif %}
                                </tr>
                            {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
            {% endfor %}
        </td>
        <!--W2-->
        <td>
            {% for j in range(0, 7) %}
                <table class="table">
                    <h3>{{weeks[j + 7].strftime("%A")}} - {{weeks[j + 7].strftime("%d/%m/%y")}}</h3>
                    <thead>
                        <th>Time</th>
                        <th>Activity Name</th>
                        <th>Spaces Left</th>
                        {% if member == False %}
                            <th>Price</th>
                        {% endif %}
                        <th></th>
                        <th></th>
                    </thead>
                    <tbody>
                        {% for i in range( numEvents2) %}
                            {% if events2[i].aDateTime.weekday() == weeks[j].weekday() %} 
                                <tr>
                                    <!--display event and event info in the tables-->
                                    <td>{{events2[i].aDateTime.strftime("%H:%M")}}</td>
                                    <td>{{eventInfo2[i].activityType}}</td>
                                    <td>{{events2[i].aCapacity-events2[i].aSlotsTaken}}</td>
                                    {% if member == False %}
                                        <td>{{events2[i].aPrice}}</td>
                                    {% endif %}
                                    {% if current_user.userType == 3 %}
                                        <td><a href="/editEvent/{{events2[i].id}}"><button type="button" class="btn btn-primary">Edit/View Event</button></td>
                                    {% else %}
                                        <td><button type="button" class="btn btn-primary event-info">Event Info 
                                            <!-- Popup for event info -->
                                            <span class="event-info-popup">
                                                <div class="table-responsive">
                                                    <table class="table popup-table">
                                                        <tr>
                                                            <td> Duration </td>
                                                            <td class="fw-light"> {{ events2[i].aDuration }}  </td>
                                                        </tr>
                                                        <tr>
                                                            <td> Location </td>
                                                            <td> {{ events2[i].aLocation }}  </td>
                                                        </tr>   
                                                        <tr>
                                                            <td> Staff </td>
                                                            <td> {{ events2[i].aStaffName }}  </td>
                                                        </tr>             
                                                        <tr>
                                                            <td> Price </td>
                                                            <td> £{{ events2[i].aPrice }}  </td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </span> 
                                        </button></td>
                                    {% endif %}
                                    <!--If statement to see if acitivity is full and whether or not to dispay bookable button-->
                                    {% if current_user.userType != 3 %}
                                        <td>
                                            {% if userBooked2[i]==True %}
                                                <a href=""></a><button type="button" class="btn btn-primary" id="disabled">Booked</button></a>
                                            {% elif events2[i].aSlotsTaken == events2[i].aCapacity %}
                                                <a href=""></a><button type="button" class="btn btn-primary" id="disabled">Full</button></a>
                                            {% else %}
                                                {% if isMember == False %}
                                                    <a href="/addBasket/{{events2[i].id}}"><button type="button" class="btn btn-primary">Add to Basket</button>
                                                {% else %}    
                                                    <a href="/makeBooking/{{events2[i].id}}"><button type="button" class="btn btn-primary">Book</button>
                                                {% endif %}
                                            {% endif %}
                                        </td>
                                    {% endif %}
                                </tr>
                            {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
            {% endfor %}
        </td>
    </tbody>
</table>


</div>

<script>
    document.getElementById('disabled').disabled= true;
</script>
{% endblock %}