<!-- Template for calender frontend -->
{% extends "base.html" %}
{% block content %}

<div class="calendar-container container-fluid">
    <div class="row m-0 p-0 mb-4 text-center">
        <!--Basic Header-->
        <p class="header p-0 m-0 pt-0 mb-0">{{eventType}}</p>
        <h4>
            Staff Member: {{events[0].aStaffName}} - Duration: {{events[0].aDuration}} hour(s)
        </h4>
    </div>

    <div class="row m-0 p-0 mb-4 text-center">
    <!--Basic Header-->
    <p class="header p-0 m-0 pt-0 mb-0">Calendar</p>
    <p class="mb-4 text-center">If you would like to book one of our sessions that is open all day please choose
        from below.</p>
    <!-- <div class="col"></div>
    <div class="col"></div> -->
    <div class="d-flex justify-content-center">
        <div class="col">
            <a href="/repeatEvents/2"><button type="button" class="btn btn-primary btn-calendar">Lane
                    Swimming</button></a>
        </div>
        <div class="col">
            <a href="/repeatEvents/4"><button type="button" class="btn  btn-primary btn-calendar">General Use
                    Swimming</button></a>
        </div>
        <div class="col">
            <a href="/repeatEvents/3"><button type="button" class="btn  btn-primary btn-calendar">Swimming
                    Lessons</button></a>
        </div>
        <div class="col">
            <a href="/repeatEvents/5"><button type="button" class="btn  btn-primary btn-calendar">Gym</button></a>
        </div>
        <div class="col">
            <a href="/repeatEvents/7"><button type="button" class="btn  btn-primary btn-calendar">Climbing</button></a>
        </div>
        <div class="col">
            <a href="/repeatEvents/6"><button type="button" class="btn  btn-primary btn-calendar">Squash</button></a>
        </div>
        <div class="col">
            <a href="/repeatEvents/12"><button type="button" class="btn  btn-primary btn-calendar">Sports Hall
                    Session</button></a>
        </div>
    </div>
    
    <!-- <div class="col"></div>
    <div class="col"></div> -->
</div>

<div id="calendar2"></div>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.4.0/main.min.css"></link>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.4.0/main.min.js"></script>

<script src='https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.5/index.global.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid@6.1.5/index.global.min.js'></script>

<script>
    document.addEventListener('DOMContentLoaded', function(){

        let cElem = document.getElementById('calendar2');

        let calendar = new FullCalendar.Calendar(cElem, { 
            //initialView: 'timeGridWeek',

            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            slotEventOverlap: false,
            navLinks: true, 
            editable: false,
            dayMaxEvents: true,
            businessHours: {
                daysOfWeek: [0,1,2,3,4,5,6],
                startTime: '8:00',
                endTime: '22:00',
            },
            displayEventTime: true,
            eventTimeFormat: {
                hour: 'numeric',
                minute: '2-digit',
                meridiem: true,
            },
            selectable: true,
            //contentHeight: 700,
            
            events: [
                {% for i in range(numEvents) %}
                    {
                        start : '{{events[i].aDateTime}}',
                        {% if isMember == True %}
                            title : 'Â£{{events[i].aPrice}} - Spaces: {{events[i].aCapacity-events[i].aSlotsTaken}}',
                        {% else %}
                            title : 'Spaces: {{events[i].aCapacity-events[i].aSlotsTaken}}',
                        {% endif %}
                    },
                {% endfor %}
            ]
        });

        calendar.render();

        let eventDivs = document.getElementsByClassName('fc-daygrid-event-harness')
        // Classes for the info pop up and booking button
        const popUpClasses  = ['event-info-div', 'rounded-4', 'p-2']
        const buttonClasses = ['btn', 'btn-responsive-calendar', 'btn-primary']

        // Loop through the event divs and add in their respective details
        let i = 0
        let infoDiv, priceP, durationP, slotsLeftP, bookBtn
        let bookBtnContent = "Book"


        {% for i in range(numEvents) %}
            infoDiv = document.createElement('div')
            infoDiv.classList.add(...popUpClasses)

            slotsLeftP = document.createElement('p')
            slotsLeftP.textContent = '{{eventType}} - {{events[i].aDateTime.strftime("%H:%M")}} \n Spaces: {{events[i].aCapacity-events[i].aSlotsTaken}}'
            infoDiv.appendChild(slotsLeftP)

            // Also want to add the book button
            bookBtn = document.createElement('a')
            bookBtn.classList.add(...buttonClasses)
            bookBtn.nodeType = 'button'
            {% if userBooked[i]==True %}
                bookBtn.href = '#'
                bookBtnContent = "Booked"
                bookBtn.classList.add('disabled')
            {% elif events[i].aSlotsTaken < events[i].aCapacity %}
                {% if isMember %}
                    bookBtn.href = '/makeBooking/{{ events[i].id }}'
                    bookBtnContent = "Book"
                {% else %}
                    bookBtn.href = '/addBasket/{{ events[i].id }}'
                    bookBtnContent = "Add to basket"
                {% endif %}
            {% else %}
                bookBtn.href = '#'
                bookBtnContent = "Full"
                bookBtn.classList.add('disabled')
            {% endif %}

            bookBtn.textContent = bookBtnContent
            infoDiv.appendChild(bookBtn)
            eventDivs[i].appendChild(infoDiv)
            i ++
        {% endfor %}
    });
</script>
{% endblock %}